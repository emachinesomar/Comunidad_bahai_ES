class n{constructor(){this.currentStep=1,this.totalSteps=18,this.formData={},this.init()}init(){this.loadSavedData(),this.bindEvents(),this.updateUI()}bindEvents(){document.getElementById("nextBtn")?.addEventListener("click",()=>this.nextStep()),document.getElementById("prevBtn")?.addEventListener("click",()=>this.prevStep()),document.getElementById("campusForm")?.addEventListener("signatureupdated",()=>this.saveCurrentStep()),document.querySelectorAll("input, select").forEach(t=>{t.addEventListener("change",()=>this.saveCurrentStep()),t.addEventListener("input",()=>this.saveCurrentStep())})}updateUI(){this.updateProgress(),document.querySelectorAll(".step-content").forEach((t,r)=>{r+1===this.currentStep?t.classList.remove("hidden"):t.classList.add("hidden")}),this.updateNavigation(),this.currentStep===this.totalSteps&&this.generateSummary()}updateProgress(){document.querySelectorAll(".w-3.h-3.rounded-full").forEach((s,e)=>{const a=e+1;s.className=`w-3 h-3 rounded-full transition-all duration-300 ${a<this.currentStep?"bg-success-500 scale-110":a===this.currentStep?"bg-primary-500 scale-125 ring-4 ring-primary-500/30":"bg-slate-600 hover:bg-slate-500"}`});const r=document.querySelector(".text-center.text-slate-300.text-sm.font-medium.mb-6");r&&(r.textContent=`${this.currentStep} de ${this.totalSteps}`)}updateNavigation(){const t=document.getElementById("nextBtn"),r=document.getElementById("prevBtn");if(r&&(r.disabled=this.currentStep===1,r.className=`flex items-center px-6 py-3 rounded-lg font-medium transition-all duration-200 ${this.currentStep===1?"text-slate-500 cursor-not-allowed":"bg-blue-500 text-slate-300 hover:text-white hover:bg-slate-700"}`),t){const s=this.canProceedToNext();t.disabled=!s,t.className=`flex items-center px-8 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105 ${s?this.currentStep===this.totalSteps?"bg-success-500 hover:bg-success-600 text-white shadow-lg":"bg-blue-500 hover:bg-primary-600 text-white shadow-lg":"bg-slate-600 text-slate-400 cursor-not-allowed"}`;const e=this.currentStep===this.totalSteps?"ENVIAR FORMULARIO":"SIGUIENTE";t.innerHTML=e+(this.currentStep!==this.totalSteps?'<svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>':"")}}canProceedToNext(){const t=document.querySelector(`[data-step="${this.currentStep}"]`);if(!t)return!1;const r=t.querySelectorAll("[required]");for(const s of r){const e=s;if(e.type==="checkbox"){if(!e.checked)return!1}else if(!e.value.trim())return!1}return this.currentStep===15?window.hasSignature?.()||!1:!0}nextStep(){if(this.currentStep<this.totalSteps&&this.canProceedToNext()){if(this.saveCurrentStep(),this.currentStep===this.totalSteps){this.submitForm();return}this.currentStep++,this.updateUI(),this.saveProgress()}}prevStep(){this.currentStep>1&&(this.currentStep--,this.updateUI(),this.saveProgress())}saveCurrentStep(){const t=document.querySelector(`[data-step="${this.currentStep}"]`);if(!t)return;t.querySelectorAll("input, select").forEach(s=>{const e=s;e.type==="checkbox"?this.formData[e.name]=e.checked:this.formData[e.name]=e.value}),this.currentStep===this.totalSteps-2&&(this.formData.signature=window.getSignatureData?.()||""),localStorage.setItem("campusFormData",JSON.stringify(this.formData)),this.updateNavigation()}loadSavedData(){const t=localStorage.getItem("campusFormData");t&&(this.formData=JSON.parse(t),Object.keys(this.formData).forEach(s=>{const e=document.querySelector(`[name="${s}"]`);e&&(e.type==="checkbox"?e.checked=this.formData[s]:e.value=this.formData[s])}));const r=localStorage.getItem("campusFormStep");r&&(this.currentStep=parseInt(r))}saveProgress(){localStorage.setItem("campusFormStep",this.currentStep.toString())}generateSummary(){const t=document.getElementById("summaryContent");if(!t)return;const r={student_name:"Nombre del estudiante",student_birthdate:"Fecha de nacimiento",student_grade:"Grado escolar",parent_email:"Correo electrónico",address:"Dirección",field_trips:"Permisos de salidas",sports:"Actividades deportivas",image_use:"Uso de imagen",medication:"Administración de medicamentos",allergies:"Alergias/Condiciones médicas",emergency_contact:"Contacto de emergencia",emergency_phone:"Teléfono de emergencia",transportation:"Transporte",accept_terms:"Términos y condiciones",accept_privacy:"Política de privacidad"};let s="";Object.keys(this.formData).forEach(e=>{if(e!=="signature"&&this.formData[e]&&r[e]){const a=this.formData[e]===!0?"Sí":this.formData[e]===!1?"No":this.formData[e];s+=`
            <div class="flex justify-between py-2 border-b border-slate-600">
              <span class="text-slate-300">${r[e]}:</span>
              <span class="text-white font-medium">${a}</span>
            </div>
          `}}),this.formData.signature&&(s+=`
          <div class="pt-4">
            <span class="text-slate-300">Firma digital:</span>
            <div class="mt-2 p-2 bg-white rounded">
              <img src="${this.formData.signature}" alt="Firma" class="max-w-full h-auto" />
            </div>
          </div>
        `),t.innerHTML=s}async submitForm(){const t=document.getElementById("nextBtn");t.innerHTML="Enviando...",t.disabled=!0;try{await new Promise(r=>setTimeout(r,2e3)),localStorage.removeItem("campusFormData"),localStorage.removeItem("campusFormStep"),alert("¡Formulario enviado exitosamente! Recibirá una confirmación por correo electrónico."),this.currentStep=1,this.formData={},document.querySelector("form")?.reset(),this.updateUI()}catch{alert("Error al enviar el formulario. Por favor, inténtelo nuevamente."),t.innerHTML="ENVIAR FORMULARIO",t.disabled=!1}}}document.addEventListener("DOMContentLoaded",()=>{new n});
